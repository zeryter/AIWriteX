# AIWriteX 安全迁移指南

## 概述

为了提升系统安全性，AIWriteX已将API密钥从配置文件迁移到环境变量。本指南将帮助您完成迁移过程。

## 迁移步骤

### 1. 创建环境变量文件

在项目根目录下创建 `.env` 文件：

```bash
cp .env.example .env
```

### 2. 配置API密钥

编辑 `.env` 文件，填入您的实际API密钥：

```bash
# AI模型API密钥
OPENROUTER_API_KEY=sk-your-openrouter-key
DEEPSEEK_API_KEY=sk-your-deepseek-key
XAI_API_KEY=your-xai-key
GEMINI_API_KEY=your-gemini-key
OLLAMA_API_KEY=your-ollama-key
SILICONFLOW_API_KEY=your-siliconflow-key

# 图片生成API密钥
ALI_IMAGE_API_KEY=your-ali-image-key

# 微信公众号配置
WECHAT_APPID=your-wechat-appid
WECHAT_APPSECRET=your-wechat-appsecret
```

### 3. 安全建议

1. **不要将 `.env` 文件提交到版本控制**
   - `.env` 文件已添加到 `.gitignore`
   - 确保您的 `.env` 文件不会被意外提交

2. **使用强密钥**
   - 主密钥（MASTER_KEY）用于加密敏感数据
   - 建议使用至少32位的随机字符串

3. **定期轮换密钥**
   - 定期更新API密钥
   - 监控API使用情况

### 4. 环境变量优先级

系统现在使用以下优先级获取API密钥：

1. **环境变量**（最高优先级）
2. **配置文件**（向后兼容）

这意味着：
- 如果设置了环境变量，将使用环境变量值
- 如果没有设置环境变量，将继续使用配置文件中的值
- 您可以逐步迁移，无需立即修改所有配置

### 5. 验证配置

启动应用后，可以通过以下方式验证配置：

1. 检查日志输出，确认没有API密钥相关的错误
2. 测试各个功能模块，确保API调用正常
3. 查看配置界面，确认API密钥显示为已配置状态

## 安全特性

### 加密存储

- API密钥支持加密存储
- 使用主密钥进行加密解密
- 内存中不存储明文密钥

### 安全显示

- 配置界面只显示密钥的部分信息（如 `sk-...abcd`）
- 完整的密钥不会暴露在用户界面

### 访问控制

- 密钥访问需要适当的权限
- 支持密钥轮换和撤销

## 故障排除

### 常见问题

1. **API密钥无效**
   - 检查环境变量是否正确设置
   - 确认密钥格式正确
   - 验证密钥是否有效

2. **环境变量未加载**
   - 确认 `.env` 文件存在
   - 检查文件权限
   - 重启应用程序

3. **配置冲突**
   - 清理配置文件中的旧密钥
   - 确保环境变量优先级正确

### 获取帮助

如遇到问题，请：

1. 检查应用程序日志
2. 验证环境变量配置
3. 参考安全配置文档
4. 联系技术支持

## 最佳实践

1. **使用密钥管理服务**
   - 考虑使用专业的密钥管理服务
   - 实现密钥的集中管理和监控

2. **定期安全审计**
   - 检查密钥使用情况
   - 监控异常访问模式
   - 及时更新安全策略

3. **最小权限原则**
   - 只授予必要的权限
   - 限制密钥的访问范围
   - 实施访问控制策略

通过遵循这些指南，您可以确保AIWriteX的API密钥安全配置，保护您的数据和系统安全。